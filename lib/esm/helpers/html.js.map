{"version":3,"sources":["../../../src/helpers/html.ts"],"names":["HTMLElement","parse","TextNode","isHtmlText","content","parseContent","Boolean","childNodes","length","generateEntityLink","otype","entity","class","id","url","generateTextElement","tag","set_content","generateLineageTableRow","entityType","ds","schema","table","attribute","row","descriptionTag","datasourceTag","schemaTag","tableTag","attributeTag","linkTag","appendChild","title","name","toUpperCase","description","generateLink","parent","link","generateLineageTable","root","head","body","insertOrReplaceTableRow","querySelector","findRow","getAttribute","removeChild"],"mappings":"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","sourcesContent":["import {HTMLElement, parse, TextNode} from 'node-html-parser';\nimport {IAlationEntity, IAttribute, IDatasource, ISchema, ITable, ObjectType} from 'alation_connector';\nimport {Assign} from 'utility-types';\n\nexport function isHtmlText(content: string): boolean {\n  const parseContent = parse(content);\n\n  return Boolean(parseContent.childNodes.length && !(parseContent.childNodes[0] instanceof TextNode));\n}\n\nexport function generateEntityLink(otype: ObjectType, entity: Assign<IAlationEntity, { url: string }>): HTMLElement {\n  return new HTMLElement('a',\n      {class: 'term_loader_link'},\n      `data-oid=\"${entity.id}\" data-otype=\"${otype}\" href=\"${entity.url}\"`, null);\n}\n\nexport function generateTextElement(content: string): HTMLElement {\n  if (isHtmlText(content)) {\n    return parse(content);\n  }\n  const tag = new HTMLElement('p', {class: 'term_loader_text'}, '', null);\n  if (content.length) tag.set_content(content);\n  return tag;\n}\n\nexport function generateLineageTableRow(entityType: 'table', ds: IDatasource, schema: ISchema, table: ITable): HTMLElement;\nexport function generateLineageTableRow(entityType: 'attribute',\n                                        ds: IDatasource,\n                                        schema: ISchema,\n                                        table: ITable,\n                                        attribute: IAttribute): HTMLElement;\nexport function generateLineageTableRow(entityType: 'attribute' | 'table',\n    ds: IDatasource,\n    schema: ISchema,\n    table: ITable,\n    attribute?: IAttribute): HTMLElement {\n  const row = new HTMLElement(\n      'tr',\n      {\n        class: 'term_loader_table_row',\n        id: `term_lineage_row_${entityType}_${(entityType === 'attribute' && attribute) ? attribute.id : table.id}`,\n      },\n      ``, null);\n\n  const descriptionTag = new HTMLElement('td', {}, '', row);\n  const datasourceTag = new HTMLElement('td', {}, '', row);\n  const schemaTag = new HTMLElement('td', {}, '', row);\n  const tableTag = new HTMLElement('td', {}, '', row);\n  const attributeTag = new HTMLElement('td', {}, '', row);\n  const linkTag = new HTMLElement('td', {}, '', row);\n\n  row.appendChild(descriptionTag);\n  row.appendChild(datasourceTag);\n  row.appendChild(schemaTag);\n  row.appendChild(tableTag);\n  row.appendChild(attributeTag);\n  row.appendChild(linkTag);\n\n  datasourceTag.appendChild(generateTextElement(ds.title));\n  schemaTag.appendChild(generateTextElement(schema.name.toUpperCase()));\n  tableTag.appendChild(generateTextElement(table.name.toUpperCase()));\n\n\n  if (entityType === 'attribute' && attribute) {\n    attributeTag.appendChild(generateTextElement(attribute.name.toUpperCase()));\n    descriptionTag.appendChild(generateTextElement(attribute.description));\n    linkTag.appendChild(generateLink(attribute.url, linkTag));\n  } else {\n    descriptionTag.appendChild(generateTextElement(table.description));\n    linkTag.appendChild(generateLink(table.url, linkTag));\n  }\n\n  return row;\n}\n\n\nexport function generateLink(url: string, parent: HTMLElement | null = null, name = 'Ссылка'): HTMLElement {\n  const link = new HTMLElement('a', {}, `href=\"${url}\"`, parent);\n  link.set_content(name);\n  return link;\n}\n\nexport function generateLineageTable(): HTMLElement {\n  const root = new HTMLElement('table',\n      {class: 'term_loader_table'},\n      'style=\"width: 100%;\"', null);\n  const head = new HTMLElement('thead',\n      {class: 'term_loader_table', id: 'term_loader_lineage_table_header'},\n      '', root);\n\n  head.appendChild(new HTMLElement('tr', {\n    class: 'term_loader_table',\n    id: 'term_loader_lineage_table_header',\n  }, '', head));\n\n  const descriptionTag = new HTMLElement('th', {}, '', head);\n  const datasourceTag = new HTMLElement('th', {}, '', head);\n  const schemaTag = new HTMLElement('th', {}, '', head);\n  const tableTag = new HTMLElement('th', {}, '', head);\n  const attributeTag = new HTMLElement('th', {}, '', head);\n  const linkTag = new HTMLElement('th', {}, '', head);\n\n  head.appendChild(descriptionTag);\n  head.appendChild(datasourceTag);\n  head.appendChild(schemaTag);\n  head.appendChild(tableTag);\n  head.appendChild(attributeTag);\n  head.appendChild(linkTag);\n\n  descriptionTag.set_content('Описание');\n  datasourceTag.set_content('Система');\n  schemaTag.set_content('Схема');\n  tableTag.set_content('Таблица');\n  attributeTag.set_content('Атрибут');\n  linkTag.set_content('Ссылка');\n\n  const body = new HTMLElement('tbody', {class: 'term_loader_table', id: 'term_loader_lineage_table_body'}, '', root);\n  root.appendChild(head);\n  root.appendChild(body);\n\n  return root;\n}\n\nexport function insertOrReplaceTableRow(table: HTMLElement, row: HTMLElement): HTMLElement {\n  const tableTag = table.querySelector('table') ?? generateLineageTable();\n  const body = tableTag.querySelector('tbody') as HTMLElement;\n  const findRow = body.querySelector(\n      // eslint-disable-next-line max-len\n      `tr#${row.getAttribute('id')}`,\n  );\n\n  if (findRow) {\n    body.removeChild(findRow);\n  }\n\n  body.appendChild(row);\n\n  return tableTag;\n}\n"],"file":"html.js"}